# 决策日志（ADR Lite）

## 2026-01-20 19:56:01

### 决策 1：标签以 `.tags.json` 为准
- 背景：需要支持批量添加/移除标签，不能依赖文件名重命名。
- 选择：在 `prompts_dir` 下维护 `.tags.json`，作为标签的权威来源；文件名/目录标签作为兜底。
- 影响：标签可稳定维护，但文件手动改名会导致映射失效（按相对路径存储）。

### 决策 2：新建空文件延迟可见
- 背景：需求要求“保存并关闭后才纳入搜索结果”。
- 选择：新建文件加入 pending 列表，文件为空时不进入索引；首次保存（非空）后展示。
- 影响：更贴近用户预期，但空文件会暂时不可搜索。

## 2026-01-20 20:11:03

### 决策 3：交互元素使用语义化标签
- 背景：Svelte a11y 警告提示点击事件缺少键盘处理与角色定义。
- 选择：将结果行替换为 `button`，并用 `pointerdown` 处理遮罩与菜单的事件阻断。
- 影响：提升可访问性与开发期质量基线，减少警告噪音。

## 2026-01-20 22:32:10

### 决策 4：启用 MSI 升级码以支持就地升级
- 背景：需要安装新版本时自动替换旧版本，并保留用户配置数据。
- 选择：在 `tauri.conf.json` 设置固定 `wix.upgradeCode`，并禁用降级安装。
- 影响：MSI 安装包可执行就地升级，用户数据仍保留在 AppConfig 目录。

## 2026-01-22 22:14:24

### 决策 5：热键注册采用“先注册后释放”，并在设置项附近展示冲突错误
- 背景：快捷键冲突时缺少可见提示，且失败会导致旧快捷键被注销，影响核心唤起能力。
- 选择：注册新快捷键成功后再注销旧快捷键，并在“快捷键”设置项下方直接展示错误信息。
- 影响：失败时保留旧快捷键，错误更易被用户发现；注册成功路径保持不变。

## 2026-01-22 22:22:32

### 决策 6：记录旧快捷键注销失败的日志并暴露失败状态
- 背景：注销旧快捷键失败时被静默吞掉，排查冲突时缺少线索。
- 选择：在安全注册流程中返回 `unregisterError` 并输出 `console.warn`。
- 影响：不会阻断新快捷键生效，但能提供可追踪的失败信息。

## 2026-01-26 20:06:46

### 决策 8：全局快捷键注册迁移到后端并引入 UI 就绪门控
- 背景：自启动场景下前端尚未就绪，快捷键注册与窗口聚焦存在时序竞态，出现无法唤起/白屏。
- 选择：后端注册全局快捷键，前端仅上报 `frontend_ready`；后端通过 `LauncherGate` 排队唤起并在显示后发出 `launcher-shown` 事件。
- 影响：快捷键与窗口展示不再依赖前端生命周期，启动阶段稳定性提升。

## 2026-01-23 12:58:45

### 决策 7：允许合并不相关历史以同步 main 分支
- 背景：本地 feature1 与远端 main 历史不相关，直接合并被 Git 拒绝。
- 选择：使用 `git merge --allow-unrelated-histories` 合并 `origin/main`。
- 影响：成功引入 main 的 LICENSE 等变更，保留现有开发改动。
