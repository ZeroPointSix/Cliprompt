# TDD 文档：标签管理与快速新建 TXT

## 1. 目标
- 覆盖标签规则、元数据读写、标签更新逻辑与标签筛选行为。
- 使用真实文件与真实目录进行测试，不使用 Mock。
- 测试由他人执行，本人不运行测试命令。

## 2. 测试原则
- 仅使用真实文件系统：在临时目录创建真实 `.txt` 和 `.tags.json`。
- 不使用 Mock、Stub、Fake。
- 测试数据来自真实文件内容与真实路径。

## 3. 测试用例清单（按模块）

### 3.1 标签规则（prompts.rs）
- `normalize_tag` 接收中英文数字，统一小写。
- `normalize_tag` 拒绝空字符串、长度 > 10、特殊字符、空格。
- `split_query` 过滤非法标签，仅保留合法 `#tag`。
- `tags_match` 使用真实文件生成 `PromptEntry` 后验证 AND 逻辑。

### 3.2 元数据读写（tags_meta.rs）
- `.tags.json` 不存在时返回默认结构。
- 保存后能正确回读（真实文件 roundtrip）。
- 元数据优先级高于文件名/目录标签（resolve 优先 meta）。
- 路径 key 使用相对路径并统一 `/` 分隔。

### 3.3 标签更新（lib.rs）
- 选中多文件批量添加/移除后，`.tags.json` 持久化成功。
- 添加非法标签时返回错误（不中断文件系统一致性）。
- 移除后可以得到空标签集（表示显式清空）。

### 3.4 快速新建 TXT（lib.rs + 前端）
- 输入文件名后创建真实 `.txt` 文件。
- 同名文件阻止创建并返回错误。
- 创建后通过 `open_prompt_path` 打开系统默认编辑器。
- `open_prompt_path` 仅允许 `prompts_dir` 内路径，越界路径返回错误。
- 保存后文件进入搜索结果（空文件不展示）。

## 4. 测试执行说明
- 测试执行人：非开发者本人。
- 执行环境：Windows + Rust toolchain + Tauri 依赖。
- 命令建议：
  - `cargo test`（由测试人员执行）

## 5. 进入实现阶段
完成测试用例编写后，进入实现阶段（GREEN），依次实现：
1) 标签规则与元数据读写
2) 标签更新命令
3) 快速新建 TXT
4) 前端交互（右键菜单 + 标签编辑 + `+` 按钮）
